<template>
    <lightning-card  variant="Narrow"  title="Selected Products" icon-name="utility:cart">
        <template if:false={loaded}>
            <lightning-spinner 
                alternative-text="Loading" 
                size="large"></lightning-spinner>
        </template>
    <template if:true={loaded}>
        <lightning-button variant="Neutral" label="Add Product" title="priceBook" onclick={openProdSearch}></lightning-button>
        <template if:true={prodFound}>
            <!-- Set Table Headers here -->
            <div class='slds-grid header'>
                <div class='slds-col slds-size_2-of-12 slds-align_absolute-center'>
                    <p class='header'>Product Name</p>
                </div>
                <div class="slds-col slds-size_1-of-12 slds-align_absolute-center">
                    <p class='header'>Qty</p>
                </div>
                <div class="slds-col slds-size_1-of-12 slds-align_absolute-center">
                    <p class='header'>Price</p>
                </div>
                <div class="slds-col slds-size_1-of-12 slds-align_absolute-center ">
                    <p class='header'>Last Paid</p>
                </div>
                <div class="slds-col slds-size_1-of-12 slds-align_absolute-center">
                    <p class='header'>Last Margin</p>
                </div>
                <div class="slds-col slds-size_1-of-12 slds-align_absolute-center">
                    <p class='header'>Margin %</p>
                </div>
                <div class="slds-col slds-size_1-of-12 slds-align_absolute-center">
                    <p class='header'>Total</p>
                </div>
                <div class="slds-col slds-size_2-of-12 slds-align_absolute-center">
                    <p class='header'>Comment</p>
                </div>
            
            </div>
            <!--Table cells here-->
            <div class='slds-grid'>
                <div class='slds-col slds-size_1-of-1'>
                <template for:each={selection} for:item="sp" >
                    <div key={sp.Id} class='slds-m-horizontal_xx-small slds-m-bottom_x-small slds-grid'>
                        <!-- <div class="slds-col slds-size_1-of-12 slds-align_absolute-center">
                            <lightning-icon icon-name="utility:close" name={sp.Id} size='small' class='hover'
                            alternative-text='remove' title="Remove" onclick={removeProd} ></lightning-icon>
                        </div> -->
                        <div class="slds-col slds-size_2-of-12 slds-align_absolute-center">
                            <lightning-icon icon-name="utility:close" name={sp.Id} size='x-small' class='hover'
                            alternative-text='remove' title="Remove" onclick={removeProd} ></lightning-icon>
                            <p class='pName'>{sp.name}</p>
                        </div>
                        <!-- user qty -->
                        <div class="slds-col slds-size_1-of-12 slds-align_absolute-center">
                            <lightning-input type="number" name={sp.Id}
                                        value={sp.Quantity} onchange={newQTY}></lightning-input>
                        </div>
                        <!-- user price -->
                        <div class="slds-col slds-size_1-of-12 slds-m-right_xx-large">
                            <lightning-input class='price' type="number"  
                                        label="" name={sp.Id} 
                                        value={sp.UnitPrice} onchange={newPrice} 
                                        formatter="currency" step="0.01"></lightning-input>
                        </div>
                        <!-- last paid -->
                        <div class="slds-col slds-size_1-of-12 slds-m-right_x-large">
                            <lightning-input type="number" name="lastPaid"  label='' 
                                        value={sp.lastPaid} formatter="currency" readonly></lightning-input>
                        </div>
                        <!-- last margin -->
                        <div class="slds-col slds-size_1-of-12 slds-m-right_large">
                            <lightning-input type="number" name="lastMarg" label="" 
                                        value={sp.lastMarg} formatter="percent" step="0.01" readonly=""></lightning-input>   
                        </div>
                        <!-- user margin can be changed or set -->
                        <div class="slds-col slds-size_1-of-12 slds-m-right_xx-large">
                            <lightning-input class='liquid' type="number"  
                                            label="" name={sp.Id} 
                                            value={sp.Margin__c} onchange={newMargin} step="0.01" ></lightning-input>
                        </div>
                        <!-- total price -->
                        <div class='slds-col slds-size_1-of-12'>
                            <lightning-input type="number" name="input4" formatter="currency"
                                             readonly value={sp.TotalPrice} label="" ></lightning-input>
                        </div>
                        <!--comments-->
                        <div class='slds-col slds-size_2-of-12'>
                            <lightning-input type="text" label=""></lightning-input>
                        </div>
                    </div>
                </template>
            </div>
            </div>
            <!--Buttons to save-->
            <lightning-button variant="success" label="Save" title="save" onclick={saveProducts}></lightning-button>
        </template>
        <template if:false={prodFound}>
            <div class='slds-m-around_large slds-align_absolute-center'>
                <h4>Selected products will appear hear</h4>
            </div>
        </template>
    </template>
    </lightning-card>
    <!-- price search -->
    <c-prod-search
                price-book-id={pbId}></c-prod-search>
    <!-- Price Book Selection -->
</template>